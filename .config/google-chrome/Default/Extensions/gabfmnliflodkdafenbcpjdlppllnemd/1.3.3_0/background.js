/*! For license information please see background.js.LICENSE.txt */
(()=>{var e={172:e=>{e.exports=function(e,t){this.v=e,this.k=t},e.exports.__esModule=!0,e.exports.default=e.exports},373:e=>{e.exports=function(e){var t=Object(e),r=[];for(var n in t)r.unshift(n);return function e(){for(;r.length;)if((n=r.pop())in t)return e.value=n,e.done=!1,e;return e.done=!0,e}},e.exports.__esModule=!0,e.exports.default=e.exports},546:e=>{function t(r,n,o,a){var c=Object.defineProperty;try{c({},"",{})}catch(r){c=0}e.exports=t=function(e,r,n,o){function a(r,n){t(e,r,function(e){return this._invoke(r,n,e)})}r?c?c(e,r,{value:n,enumerable:!o,configurable:!o,writable:!o}):e[r]=n:(a("next",0),a("throw",1),a("return",2))},e.exports.__esModule=!0,e.exports.default=e.exports,t(r,n,o,a)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports},579:(e,t,r)=>{var n=r(738).default;e.exports=function(e){if(null!=e){var t=e["function"==typeof Symbol&&Symbol.iterator||"@@iterator"],r=0;if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length))return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}}}throw new TypeError(n(e)+" is not iterable")},e.exports.__esModule=!0,e.exports.default=e.exports},633:(e,t,r)=>{var n=r(172),o=r(993),a=r(869),c=r(887),u=r(791),i=r(373),s=r(579);function f(){"use strict";var t=o(),r=t.m(f),p=(Object.getPrototypeOf?Object.getPrototypeOf(r):r.__proto__).constructor;function l(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===p||"GeneratorFunction"===(t.displayName||t.name))}var m={throw:1,return:2,break:3,continue:3};function v(e){var t,r;return function(n){t||(t={stop:function(){return r(n.a,2)},catch:function(){return n.v},abrupt:function(e,t){return r(n.a,m[e],t)},delegateYield:function(e,o,a){return t.resultName=o,r(n.d,s(e),a)},finish:function(e){return r(n.f,e)}},r=function(e,r,o){n.p=t.prev,n.n=t.next;try{return e(r,o)}finally{t.next=n.n}}),t.resultName&&(t[t.resultName]=n.v,t.resultName=void 0),t.sent=n.v,t.next=n.n;try{return e.call(this,t)}finally{n.p=t.prev,n.n=t.next}}}return(e.exports=f=function(){return{wrap:function(e,r,n,o){return t.w(v(e),r,n,o&&o.reverse())},isGeneratorFunction:l,mark:t.m,awrap:function(e,t){return new n(e,t)},AsyncIterator:u,async:function(e,t,r,n,o){return(l(t)?c:a)(v(e),t,r,n,o)},keys:i,values:s}},e.exports.__esModule=!0,e.exports.default=e.exports)()}e.exports=f,e.exports.__esModule=!0,e.exports.default=e.exports},738:e=>{function t(r){return e.exports=t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e.exports.__esModule=!0,e.exports.default=e.exports,t(r)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports},756:(e,t,r)=>{var n=r(633)();e.exports=n;try{regeneratorRuntime=n}catch(e){"object"==typeof globalThis?globalThis.regeneratorRuntime=n:Function("r","regeneratorRuntime = r")(n)}},791:(e,t,r)=>{var n=r(172),o=r(546);e.exports=function e(t,r){function a(e,o,c,u){try{var i=t[e](o),s=i.value;return s instanceof n?r.resolve(s.v).then(function(e){a("next",e,c,u)},function(e){a("throw",e,c,u)}):r.resolve(s).then(function(e){i.value=e,c(i)},function(e){return a("throw",e,c,u)})}catch(e){u(e)}}var c;this.next||(o(e.prototype),o(e.prototype,"function"==typeof Symbol&&Symbol.asyncIterator||"@asyncIterator",function(){return this})),o(this,"_invoke",function(e,t,n){function o(){return new r(function(t,r){a(e,n,t,r)})}return c=c?c.then(o,o):o()},!0)},e.exports.__esModule=!0,e.exports.default=e.exports},869:(e,t,r)=>{var n=r(887);e.exports=function(e,t,r,o,a){var c=n(e,t,r,o,a);return c.next().then(function(e){return e.done?e.value:c.next()})},e.exports.__esModule=!0,e.exports.default=e.exports},887:(e,t,r)=>{var n=r(993),o=r(791);e.exports=function(e,t,r,a,c){return new o(n().w(e,t,r,a),c||Promise)},e.exports.__esModule=!0,e.exports.default=e.exports},993:(e,t,r)=>{var n=r(546);function o(){var t,r,a="function"==typeof Symbol?Symbol:{},c=a.iterator||"@@iterator",u=a.toStringTag||"@@toStringTag";function i(e,o,a,c){var u=o&&o.prototype instanceof f?o:f,i=Object.create(u.prototype);return n(i,"_invoke",function(e,n,o){var a,c,u,i=0,f=o||[],p=!1,l={p:0,n:0,v:t,a:m,f:m.bind(t,4),d:function(e,r){return a=e,c=0,u=t,l.n=r,s}};function m(e,n){for(c=e,u=n,r=0;!p&&i&&!o&&r<f.length;r++){var o,a=f[r],m=l.p,v=a[2];e>3?(o=v===n)&&(u=a[(c=a[4])?5:(c=3,3)],a[4]=a[5]=t):a[0]<=m&&((o=e<2&&m<a[1])?(c=0,l.v=n,l.n=a[1]):m<v&&(o=e<3||a[0]>n||n>v)&&(a[4]=e,a[5]=n,l.n=v,c=0))}if(o||e>1)return s;throw p=!0,n}return function(o,f,v){if(i>1)throw TypeError("Generator is already running");for(p&&1===f&&m(f,v),c=f,u=v;(r=c<2?t:u)||!p;){a||(c?c<3?(c>1&&(l.n=-1),m(c,u)):l.n=u:l.v=u);try{if(i=2,a){if(c||(o="next"),r=a[o]){if(!(r=r.call(a,u)))throw TypeError("iterator result is not an object");if(!r.done)return r;u=r.value,c<2&&(c=0)}else 1===c&&(r=a.return)&&r.call(a),c<2&&(u=TypeError("The iterator does not provide a '"+o+"' method"),c=1);a=t}else if((r=(p=l.n<0)?u:e.call(n,l))!==s)break}catch(e){a=t,c=1,u=e}finally{i=1}}return{value:r,done:p}}}(e,a,c),!0),i}var s={};function f(){}function p(){}function l(){}r=Object.getPrototypeOf;var m=[][c]?r(r([][c]())):(n(r={},c,function(){return this}),r),v=l.prototype=f.prototype=Object.create(m);function h(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,l):(e.__proto__=l,n(e,u,"GeneratorFunction")),e.prototype=Object.create(v),e}return p.prototype=l,n(v,"constructor",l),n(l,"constructor",p),p.displayName="GeneratorFunction",n(l,u,"GeneratorFunction"),n(v),n(v,u,"Generator"),n(v,c,function(){return this}),n(v,"toString",function(){return"[object Generator]"}),(e.exports=o=function(){return{w:i,m:h}},e.exports.__esModule=!0,e.exports.default=e.exports)()}e.exports=o,e.exports.__esModule=!0,e.exports.default=e.exports}},t={};function r(n){var o=t[n];if(void 0!==o)return o.exports;var a=t[n]={exports:{}};return e[n](a,a.exports,r),a.exports}r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},r.d=(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{"use strict";function e(e,t,r,n,o,a,c){try{var u=e[a](c),i=u.value}catch(e){return void r(e)}u.done?t(i):Promise.resolve(i).then(n,o)}function t(t){return function(){var r=this,n=arguments;return new Promise(function(o,a){var c=t.apply(r,n);function u(t){e(c,o,a,u,i,"next",t)}function i(t){e(c,o,a,u,i,"throw",t)}u(void 0)})}}var n=r(756),o=r.n(n);function a(e){return a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a(e)}function c(e,t,r){return(t=function(e){var t=function(e){if("object"!=a(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=a(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==a(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var u="siat",i=function(e){var t=function(e){return e.split("").map(function(e){return String.fromCharCode(e.charCodeAt(0)+3)}).join("")}(e.split("").reverse().join(""));return u+t},s=function(e){return function(e){return e.split("").map(function(e){return String.fromCharCode(e.charCodeAt(0)-3)}).join("")}(e.slice(4)).split("").reverse().join("")};const f={getItem:function(){var e=t(o().mark(function e(t){var r,n;return o().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=1,chrome.storage.local.get([t]);case 1:if(r=e.sent,"string"!=typeof(n=r[t])||!n.startsWith(u)){e.next=4;break}return e.prev=2,e.abrupt("return",JSON.parse(s(n)));case 3:return e.prev=3,e.catch(2),e.abrupt("return",null);case 4:return e.abrupt("return",n);case 5:case"end":return e.stop()}},e,null,[[2,3]])}));return function(t){return e.apply(this,arguments)}}(),setItem:function(){var e=t(o().mark(function e(t,r){var n,a;return o().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n=JSON.stringify(r),a=i(n),e.abrupt("return",chrome.storage.local.set(c({},t,a)));case 1:return e.prev=1,e.catch(0),e.abrupt("return",Promise.reject(new Error("Value must be JSON-serializable")));case 2:case"end":return e.stop()}},e,null,[[0,1]])}));return function(t,r){return e.apply(this,arguments)}}(),removeItem:function(e){return chrome.storage.local.remove(e)}},p="IT",l="DIT",m="SCOUNT",v={JPG:"JPG",PNG:"PNG",WebP:"WebP"};var h,d;function x(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return y(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?y(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,c=!0,u=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return c=e.done,e},e:function(e){u=!0,a=e},f:function(){try{c||null==r.return||r.return()}finally{if(u)throw a}}}}function y(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function g(){return(g=t(o().mark(function e(){var t,r;return o().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=1,f.getItem(m);case 1:return t=e.sent,r="number"==typeof t&&t?t+1:1,e.next=2,f.setItem(m,r);case 2:case"end":return e.stop()}},e)}))).apply(this,arguments)}function b(e,t){chrome.downloads.download({url:e,filename:t,saveAs:!0},function(e){if(!e){var t=chrome.i18n.getMessage("errorOnSaving");return chrome.runtime.lastError&&(t+=": \n".concat(chrome.runtime.lastError.message)),void M(t)}!function(){g.apply(this,arguments)}()})}function w(e,t){return _.apply(this,arguments)}function _(){return _=t(o().mark(function e(r,n){return o().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!r.startsWith("data:")){e.next=1;break}return n(null,r),e.abrupt("return");case 1:fetch(r).then(function(e){return e.blob()}).then(function(e){if(!e.size)throw"Fetch failed of 0 size";var r=new FileReader;r.onload=function(){var e=t(o().mark(function e(t){var r;return o().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:r=t.target.result,n(null,r);case 1:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),r.readAsDataURL(e)}).catch(function(e){return n(e.message||e)});case 2:case"end":return e.stop()}},e)})),_.apply(this,arguments)}function k(e,t){if(e.match(/googleusercontent\.com\/[0-9a-zA-Z]{30,}/))return"screenshot.".concat(t);if(e.startsWith("blob:")||e.startsWith("data:"))return"Untitled.".concat(t);var r=e.replace(/[?#].*/,"").replace(/.*[\/]/,"").replace(/\+/g," ");for(r=(r=decodeURIComponent(r)).replace(/[\x00-\x7f]+/g,function(e){return e.replace(/[^\w\-\.\,@ ]+/g,"")});r.match(/\.[^0-9a-z]*\./);)r=r.replace(/\.[^0-9a-z]*\./g,".");return(r=(r=r.replace(/\s\s+/g," ").trim()).replace(/\.(jpe?g|png|gif|webp|svg)$/gi,"").trim()).length>32&&(r=r.substr(0,32)),(r=r.replace(/[^0-9a-z]+$/i,"").trim())||(r="image"),"".concat(r,".").concat(t)}function M(e){e.error&&(e="".concat(chrome.i18n.getMessage(e.error)||e.error,"\n").concat(e.srcUrl||e.src))}function S(){return d||(d={},["errorOnSaving","errorOnLoading"].forEach(function(e){d[e]=chrome.i18n.getMessage(e)})),d}function P(e){return j.apply(this,arguments)}function j(){return(j=t(o().mark(function e(t){var r,n,a,c,u;return o().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=chrome.runtime.getURL(t),e.next=1,clients.matchAll();case 1:n=e.sent,a=x(n),e.prev=2,a.s();case 3:if((c=a.n()).done){e.next=5;break}if(c.value.url!==r){e.next=4;break}return e.abrupt("return",!0);case 4:e.next=3;break;case 5:e.next=7;break;case 6:e.prev=6,u=e.catch(2),a.e(u);case 7:return e.prev=7,a.f(),e.finish(7);case 8:return e.abrupt("return",!1);case 9:case"end":return e.stop()}},e,null,[[2,6,7,8]])}))).apply(this,arguments)}function I(){[v.JPG,v.PNG,v.WebP].forEach(function(e){chrome.contextMenus.create({id:"save_as_".concat(e.toLowerCase()),title:chrome.i18n.getMessage("Save_as",[e]),type:"normal",contexts:["image"]})}),chrome.contextMenus.create({id:"sep_1",type:"separator",contexts:["image"]}),chrome.contextMenus.create({id:"set_default",title:chrome.i18n.getMessage("Set_default_type"),type:"normal",contexts:["image"]}),chrome.contextMenus.create({id:"view_in_store",title:chrome.i18n.getMessage("View_in_store"),type:"normal",contexts:["image"]})}function O(){return(O=t(o().mark(function e(){var t;return o().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,I(),e.next=1,f.getItem(l);case 1:if(!(t=e.sent)||![v.JPG,v.PNG,v.WebP].includes(t)){e.next=3;break}return e.next=2,chrome.contextMenus.removeAll();case 2:chrome.contextMenus.create({id:"save_as_".concat(t.toLowerCase()),title:chrome.i18n.getMessage("Save_as",[t]),type:"normal",contexts:["image"]});case 3:e.next=5;break;case 4:e.prev=4,e.catch(0),I();case 5:case"end":return e.stop()}},e,null,[[0,4]])}))).apply(this,arguments)}function G(){return N.apply(this,arguments)}function N(){return(N=t(o().mark(function e(){var t;return o().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=1,f.getItem(l);case 1:return t=e.sent,e.next=2,chrome.contextMenus.removeAll();case 2:t&&[v.JPG,v.PNG,v.WebP].includes(t)?chrome.contextMenus.create({id:"save_as_".concat(t.toLowerCase()),title:chrome.i18n.getMessage("Save_as",[t]),type:"normal",contexts:["image"]}):I(),e.next=4;break;case 3:e.prev=3,e.catch(0),I();case 4:case"end":return e.stop()}},e,null,[[0,3]])}))).apply(this,arguments)}function T(){return(T=t(o().mark(function e(){var t;return o().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=1,f.getItem(l);case 1:if(!(t=e.sent)||![v.JPG,v.PNG,v.WebP].includes(t)){e.next=3;break}return e.next=2,chrome.contextMenus.update("save_as_".concat(t.toLowerCase()),{visible:!0});case 2:e.next=4;break;case 3:return e.next=4,chrome.contextMenus.update("view_in_store",{visible:!0});case 4:e.next=6;break;case 5:e.prev=5,e.catch(0),G();case 6:case"end":return e.stop()}},e,null,[[0,5]])}))).apply(this,arguments)}null!==(h=chrome.i18n)&&void 0!==h&&h.getMessage||(chrome.i18n||(chrome.i18n={}),chrome.i18n.getMessage=function(e,t){return"View_in_store"==e?"View in store":"Save_as"==e&&null!=t&&t[0]?"Save as ".concat(t[0]):e}),chrome.runtime.onInstalled.addListener(function(e){!function(){O.apply(this,arguments)}(),S(),e.reason===chrome.runtime.OnInstalledReason.INSTALL&&f.setItem(p,Date.now())}),chrome.storage.onChanged.addListener(function(e,t){"local"===t&&e[l]&&G()}),chrome.runtime.onMessage.addListener(function(e,t,r){var n=e||{},o=n.target,a=n.op;if("background"==o&&a){if("checkContextMenu"===a)return void function(){T.apply(this,arguments)}();if("download"==a)b(e.url,e.filename);else if("notify"==a){var c=e.message;if(c&&c.error){var u=chrome.i18n.getMessage(c.error)||c.error;c.src&&(u+="\n".concat(c.src)),M(u)}else M(e)}else console.warn("unknown op: ".concat(a))}}),chrome.contextMenus.onClicked.addListener(function(){var e=t(o().mark(function e(r,n){var a,c,u,i,s,f,p,l,m,v,h;return o().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a=r.menuItemId,c=r.mediaType,u=r.srcUrl,i=function(){return chrome.tabs.connect(n.id,{name:"convertType",frameId:r.frameId})},!a.startsWith("save_as_")){e.next=3;break}if("image"!=c||!u){e.next=2;break}if(s=a.replace("save_as_",""),f=k(u,s),"avif"===s&&(p=function(){var e=!1;try{var t=document.createElement("canvas"),r=t.getContext("2d");r&&(r.fillStyle="#fff",r.fillRect(0,0,1,1),e=t.toDataURL("image/avif").startsWith("data:image/avif"))}catch(e){}return e},l=function(){p()},m=function(){var e=t(o().mark(function e(){return o().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=1,Promise.resolve();case 1:return l(),e.abrupt("return",null);case 2:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}(),m()),S(),v=u.startsWith("data:image/".concat("jpg"==s?"jpeg":s,";")),chrome.offscreen){e.next=1;break}return h=r.frameId?[]:void 0,e.next=1,chrome.scripting.executeScript({target:{tabId:n.id,frameIds:h},files:["offscreen.js"]});case 1:return w(u,function(){var e=t(o().mark(function e(t,r){var n,a;return o().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!t){e.next=1;break}return M({error:t,srcUrl:u}),e.abrupt("return");case 1:if(chrome.offscreen){e.next=3;break}return n=i(),e.next=2,n.postMessage({op:v?"download":"convertType",target:"content",src:r,type:s,filename:f});case 2:return e.abrupt("return");case 3:if(!v){e.next=4;break}return b(r,f),e.abrupt("return");case 4:return a="offscreen.html",e.next=5,P(a);case 5:if(e.sent){e.next=6;break}return e.next=6,chrome.offscreen.createDocument({url:chrome.runtime.getURL(a),reasons:["DOM_SCRAPING"],justification:"Download a image for user"});case 6:return e.next=7,chrome.runtime.sendMessage({op:"convertType",target:"offscreen",src:r,type:s,filename:f});case 7:case"end":return e.stop()}},e)}));return function(t,r){return e.apply(this,arguments)}}()),e.abrupt("return");case 2:return M(chrome.i18n.getMessage("errorIsNotImage")),e.abrupt("return");case 3:"view_in_store"==a&&chrome.tabs.create({url:"https://chromewebstore.google.com/detail/save-image-as-type/gabfmnliflodkdafenbcpjdlppllnemd",index:n.index+1}),"set_default"==a&&chrome.action.openPopup();case 4:case"end":return e.stop()}},e)}));return function(t,r){return e.apply(this,arguments)}}())})()})();